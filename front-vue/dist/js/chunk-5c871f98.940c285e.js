(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c871f98"],{"0f66":function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return s}));var o=r("b775"),a={nodeList:"node/list",nodeRemove:"node/remove"};function n(t){return Object(o["b"])({url:a.nodeList,method:"post",data:t})}function s(t){return Object(o["b"])({url:a.nodeRemove,method:"post",data:t})}},"328a":function(t,e,r){"use strict";var o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("a-card",{attrs:{bordered:!1,size:"small"}},[r("a-descriptions",{attrs:{title:"执行信息"}},[r("a-descriptions-item",{attrs:{label:"命令名称"}},[t._v(t._s(t.cmdName))]),r("a-descriptions-item",{attrs:{label:"执行ID"}},[t._v(t._s(t.record.id))]),r("a-descriptions-item",{attrs:{label:"执行用户"}},[t._v(t._s(t.record.user))])],1),r("a-descriptions",[r("a-descriptions-item",{attrs:{label:"状态"}},[t.record.result_at>0?r("span",{staticStyle:{color:"#3CB371"}},[t._v("已完成")]):r("span",{staticStyle:{color:"#48D1CC"}},[t._v("执行中")])]),r("a-descriptions-item",{attrs:{label:"创建时间"}},[t._v(t._s(t._f("formatDate")(t.record.create_at)))]),t.record.result_at>0?r("a-descriptions-item",{attrs:{label:"执行时长"}},[t._v(t._s(t.record.result_at-t.record.create_at)+" 秒")]):t._e()],1),r("a-descriptions",[r("a-descriptions-item",{attrs:{label:"执行节点"}},[t._v(t._s(t.record.node))]),r("a-descriptions-item",{attrs:{label:"执行目录"}},[t._v('"'+t._s(t.record.dir)+'"')])],1),r("a-divider",{staticStyle:{"margin-bottom":"12px"}}),r("a-descriptions",{attrs:{title:"脚本内容"}},[r("div",[r("a-textarea",{staticStyle:{background:"#0e0e0e",color:"white"},attrs:{value:t.record.context,"auto-size":{minRows:4,maxRows:10}}})],1)]),r("a-divider",{staticStyle:{"margin-bottom":"12px"}}),r("a-descriptions",{attrs:{title:"执行结果"}},[r("div",[r("a-textarea",{staticStyle:{background:"#0e0e0e",color:"white"},attrs:{value:t.record.result,"auto-size":{minRows:4,maxRows:10}}})],1)])],1)},a=[],n=r("c1df"),s=r.n(n),i={name:"LogInfo",components:{moment:s.a},props:{cmdName:{type:String,default:"null"},record:{type:Object,default:null}},data:function(){return{}},filters:{formatDate:function(t){return s.a.unix(t).format("YYYY-MM-DD HH:mm:ss")}},mounted:function(){},methods:{}},c=i,d=r("2877"),l=Object(d["a"])(c,o,a,!1,null,null,null);e["a"]=l.exports},6382:function(t,e,r){"use strict";r.r(e);var o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("page-header-wrapper",{attrs:{breadcrumb:{},title:"执行命令",content:"( "+t.form.name+" )"},on:{back:function(){return t.$router.go(-1)}}},[r("a-card",{attrs:{bordered:!1}},[r("a-spin",{attrs:{spinning:t.spinning}},[r("a-form-model",{ref:"cmdExecForm",attrs:{model:t.form,rules:t.formRule,"label-col":{span:2},"wrapper-col":{span:20}}},[r("a-form-model-item",{attrs:{label:"命令类型"}},[r("span",[t._v("SHELL")])]),r("a-form-model-item",{attrs:{label:"命令内容"}},[r("a-textarea",{staticStyle:{background:"#0e0e0e",color:"white"},attrs:{"auto-size":{minRows:4,maxRows:10},readOnly:t.ctx_readonly},model:{value:t.form.context,callback:function(e){t.$set(t.form,"context",e)},expression:"form.context"}})],1),r("a-form-model-item",{attrs:{label:"执行目录","wrapper-col":{span:6}}},[r("a-input",{attrs:{placeholder:"非必填，默认为节点启动目录"},model:{value:t.form.dir,callback:function(e){t.$set(t.form,"dir",e)},expression:"form.dir"}})],1),r("a-form-model-item",{attrs:{"wrapper-col":{span:4},prop:"timeout"}},[r("span",{attrs:{slot:"label"},slot:"label"},[t._v(" 超时时间  "),r("a-tooltip",{attrs:{title:"可设置范围10～86400秒，默认60秒。超时后，会强制终止进程"}},[r("a-icon",{attrs:{type:"question-circle-o"}})],1)],1),r("a-input",{model:{value:t.form.timeout,callback:function(e){t.$set(t.form,"timeout",e)},expression:"form.timeout"}},[r("span",{attrs:{slot:"addonAfter"},slot:"addonAfter"},[t._v("秒")])])],1),r("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:t.hasArgs,expression:"hasArgs"}],attrs:{label:"命令参数"}},[r("a-row",{staticStyle:{background:"#F0F0F0"}},[r("a-col",{attrs:{span:4}},[t._v("  参数名")]),r("a-col",{attrs:{span:12}},[t._v("参数值")])],1),t._l(t.form.args,(function(e,o){return[r("a-row",{key:o},[r("a-col",{attrs:{span:4}},[r("span",[t._v("  "+t._s(o))])]),r("a-col",{attrs:{span:12}},[r("a-input",{model:{value:t.form.args[o],callback:function(e){t.$set(t.form.args,o,e)},expression:"form.args[kk]"}})],1)],1)]}))],2),r("a-form-model-item",{attrs:{label:"选择执行节点",prop:"node","wrapper-col":{span:4}}},[r("a-select",{attrs:{placeholder:"选择一个可执行的节点"},model:{value:t.form.node,callback:function(e){t.$set(t.form,"node",e)},expression:"form.node"}},[t._l(t.nodes,(function(e,o){return[r("a-select-option",{key:o,attrs:{value:e.name}},[t._v(" "+t._s(e.name)+" ")])]}))],2)],1),r("a-form-model-item",{attrs:{"wrapper-col":{span:12,offset:2}}},[r("a-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(" 执行命令 ")])],1)],1)],1)],1)],1)},a=[],n=r("5530"),s=(r("b64b"),r("d3b7"),r("b0c0"),r("0f66")),i=r("bb62"),c=r("328a"),d={name:"CmdExec",data:function(){return{formRule:{timeout:[{validator:this.checkTimout,message:"请设置一个合适的时间",trigger:"change"}],node:[{required:!0,message:"选择一个节点",trigger:"blur"}]},ctx_readonly:!0,hasArgs:!1,nodes:[],form:{id:0,name:"",context:"",dir:"",args:{},node:"",timeout:60},spinning:!1}},mounted:function(){this.$route.params.record?(this.form=Object(n["a"])(Object(n["a"])({},this.$route.params.record),{},{timeout:60}),this.hasArgs=Object.keys(this.form.args).length>0):this.$router.back(),this.getNodeList()},methods:{getNodeList:function(){var t=this,e={pageNo:1,pageSize:1e3};Object(s["a"])(e).then((function(e){for(var r in e.nodeList){var o=e.nodeList[r];o.online&&t.nodes.push(o)}}))},onSubmit:function(){var t=this;this.$refs.cmdExecForm.validate((function(e){if(!e)return!1;var r={id:t.form.id,dir:t.form.dir,args:t.form.args,node:t.form.node,timeout:parseInt(t.form.timeout)},o=1e3*(t.form.timeout+6);t.spinning=!0,Object(i["c"])(o,r).then((function(e){t.spinning=!1,t.showLogInfo(e)})).catch((function(t){})).finally((function(e){t.spinning=!1}))}))},checkTimout:function(t,e,r){e<10||e>86400?r(new Error("请输入一个合适的超时时长")):r()},showLogInfo:function(t){this.$dialog(c["a"],{cmdName:this.form.name,record:t,on:{ok:function(){},cancel:function(){},close:function(){}}},{title:"执行日志",width:1e3,centered:!0,maskClosable:!0})}}},l=d,m=r("2877"),u=Object(m["a"])(l,o,a,!1,null,"7958c93c",null);e["default"]=u.exports},bb62:function(t,e,r){"use strict";r.d(e,"d",(function(){return n})),r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return i})),r.d(e,"f",(function(){return c})),r.d(e,"c",(function(){return d})),r.d(e,"e",(function(){return l}));var o=r("b775"),a={cmdList:"cmd/list",cmdCreate:"cmd/create",cmdDelete:"cmd/delete",cmdUpdate:"cmd/update",cmdExec:"cmd/exec",cmdLog:"cmd/log"};function n(t){return Object(o["b"])({url:a.cmdList,method:"post",data:t})}function s(t){return Object(o["b"])({url:a.cmdCreate,method:"post",data:t})}function i(t){return Object(o["b"])({url:a.cmdDelete,method:"post",data:t})}function c(t){return Object(o["b"])({url:a.cmdUpdate,method:"post",data:t})}function d(t,e){return Object(o["b"])({url:a.cmdExec,method:"post",timeout:t,data:e})}function l(t){return Object(o["b"])({url:a.cmdLog,method:"post",data:t})}}}]);