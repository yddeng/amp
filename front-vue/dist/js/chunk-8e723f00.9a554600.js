(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8e723f00"],{5017:function(t,s,a){"use strict";a.r(s);var e=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("page-header-wrapper",{attrs:{title:!1,breadcrumb:{}}},[a("template",{slot:"content"},[a("div",{staticStyle:{height:"40px",width:"540px",margin:"0 auto"}},[a("a-tree-select",{staticStyle:{width:"260px"},attrs:{"dropdown-style":{maxHeight:"400px",overflow:"auto"},"tree-data":t.treeData,"show-search":"","allow-clear":"",placeholder:"选择分组"},on:{select:t.onChange},model:{value:t.path,callback:function(s){t.path=s},expression:"path"}}),a("a-popconfirm",{attrs:{title:"确定要删除当前分组吗？"},on:{confirm:t.deleteGroup}},[a("a-button",{staticStyle:{color:"white"},attrs:{icon:"delete",type:"danger"}})],1),t._v("   "),a("a-button",{attrs:{icon:"caret-right",type:"primary"},on:{click:t.startAllProcess}},[t._v("全部启动")]),t._v("   "),a("a-button",{attrs:{icon:"poweroff",type:"primary"},on:{click:t.stopAllProcess}},[t._v(" 全部停止")])],1),a("a-divider",{attrs:{dashed:"",orientation:"left"}}),a("div",{staticStyle:{padding:"10px 20px"}},[a("a-row",[a("a-col",{staticClass:"header-col",attrs:{xs:8,sm:8,xl:4}},[a("span",{staticClass:"header-card-title"},[a("a-icon",{attrs:{type:"team"}}),t._v(" 总计")],1),a("br"),a("span",{staticClass:"header-card-value"},[t._v(t._s(t.status.length))]),a("br")]),a("a-col",{staticClass:"header-col",attrs:{xs:8,sm:8,xl:4}},[a("span",{staticClass:"header-card-title"},[a("a-icon",{attrs:{type:"alert"}}),t._v(" 预警中")],1),a("br"),a("span",{staticClass:"header-card-value"},[t._v(t._s(t.status.alert))]),a("br")]),a("a-col",{staticClass:"header-col",attrs:{xs:8,sm:8,xl:4}},[a("span",{staticClass:"header-card-title"},[a("a-tooltip",{attrs:{title:"节点离线，服务正处于Starting、Running、Stopping，不确定将要转换的状态"}},[a("a-icon",{attrs:{type:"question-circle"}})],1),t._v(" 未知 ")],1),a("br"),a("span",{staticClass:"header-card-value"},[t._v(t._s(t.status.unknown))]),a("br")]),a("a-col",{staticClass:"header-col",attrs:{xs:8,sm:8,xl:4}},[a("span",{staticClass:"header-card-title"},[a("a-icon",{attrs:{type:"loading"}}),t._v(" 运行中")],1),a("br"),a("span",{staticClass:"header-card-value",staticStyle:{color:"#1ABB9C"}},[t._v(t._s(t.status.running))]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.status.starting>0,expression:"status.starting > 0 "}]},[a("a-icon",{attrs:{type:"caret-left"}}),t._v(t._s(t.status.starting))],1)]),a("a-col",{staticClass:"header-col",attrs:{xs:8,sm:8,xl:4}},[a("span",{staticClass:"header-card-title"},[a("a-icon",{attrs:{type:"stop"}}),t._v(" 已停止")],1),a("br"),a("span",{staticClass:"header-card-value"},[t._v(t._s(t.status.stopped))]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.status.stopping>0,expression:"status.stopping > 0 "}]},[a("a-icon",{attrs:{type:"caret-left"}}),t._v(t._s(t.status.stopping))],1)]),a("a-col",{staticClass:"header-col",attrs:{xs:8,sm:8,xl:4}},[a("span",{staticClass:"header-card-title"},[a("a-icon",{attrs:{type:"close"}}),t._v(" 已失败")],1),a("br"),a("span",{staticClass:"header-card-value",staticStyle:{color:"red"}},[t._v(t._s(t.status.exited))]),a("br")])],1)],1)],1),a("a-list",{attrs:{grid:{gutter:16,xs:1,sm:1,md:2,lg:3,xl:3,xxl:4},"data-source":t.status.process},scopedSlots:t._u([{key:"renderItem",fn:function(s){return a("a-list-item",{},[s&&void 0!==s.id?[a("a-card",{attrs:{title:s.name,size:"small",bordered:!1}},[a("template",{slot:"extra"},[a("a-icon",{staticStyle:{color:"#2894FF"},attrs:{type:"bell"},on:{click:t.processBell}})],1),a("a-row",[a("a-col",{attrs:{span:3}},[t._v("节点")]),a("a-col",{attrs:{span:20}},[t._v(t._s(s.node))])],1),a("a-row",[a("a-col",{attrs:{span:3}},[t._v("命令")]),s.command.length>30?a("a-tooltip",{attrs:{title:s.command}},[a("a-col",{attrs:{span:20}},[t._v(t._s(s.command.slice(0,30)+"..."))])],1):a("a-col",{attrs:{span:20}},[t._v(t._s(s.command))])],1),a("a-row",[a("a-col",{attrs:{span:3}},[t._v("分组")]),s.groups.length>30?a("a-tooltip",{attrs:{title:s.groups}},[a("a-col",{attrs:{span:20}},[t._v(t._s(s.groups.slice(0,30)+"..."))])],1):a("a-col",{attrs:{span:20}},[t._v(t._s(s.groups))])],1),a("a-row",[a("a-col",{attrs:{span:3}},[t._v("状态")]),a("a-col",{attrs:{span:20}},["Exited"===s.state.status?[a("a-popconfirm",{staticStyle:{width:"200px"},attrs:{placement:"topRight"}},[a("span",{staticStyle:{"white-space":"pre-wrap"},attrs:{slot:"title"},slot:"title"},[t._v(t._s(s.state.exit_msg))]),a("a",{staticClass:"state_info",staticStyle:{background:"#FF7575",color:"white"},attrs:{href:"#"}},[t._v("Exited")])])]:"Running"===s.state.status?[a("span",{staticClass:"state_info",staticStyle:{background:"#1ABB9C"}},[t._v(t._s(s.state.status))]),a("span",{staticClass:"state_desc"},[t._v("Pid:"+t._s(s.state.pid)+",Age: "+t._s(t._f("showAge")(s.state.timestamp))+" ")])]:"Starting"===s.state.status?[a("span",{staticClass:"state_info",staticStyle:{background:"#01B468"}},[t._v(t._s(s.state.status))])]:"Stopping"===s.state.status?[a("span",{staticClass:"state_info",staticStyle:{background:"#D0D0D0"}},[t._v(t._s(s.state.status))])]:"Unknown"===s.state.status?[a("span",{staticClass:"state_info",staticStyle:{background:"#E0E0E0"}},[t._v(t._s(s.state.status))]),a("a-tooltip",{attrs:{title:"节点离线，服务正处于Starting、Running、Stopping，不确定将要转换的状态"}},[a("a-icon",{attrs:{type:"question-circle-o"}})],1)]:[a("span",{staticClass:"state_info",staticStyle:{background:"#F0F0F0"}},[t._v(t._s(s.state.status))])]],2)],1),a("a-row",[a("a-col",{attrs:{span:3}},[t._v("CPU")]),a("a-col",{attrs:{span:15}},[a("a-progress",{attrs:{"stroke-color":t.progressColor(s.state.cpu),percent:parseFloat(s.state.cpu.toFixed(2))}})],1)],1),a("a-row",[a("a-col",{attrs:{span:3}},[t._v("内存")]),a("a-col",{attrs:{span:15}},[a("a-progress",{attrs:{"stroke-color":t.progressColor(s.state.mem),percent:parseFloat(s.state.mem.toFixed(2))}})],1)],1),a("template",{slot:"actions"},["Exited"===s.state.status||"Stopped"===s.state.status?a("a",{on:{click:function(a){return t.startProcess(s.id)}}},[t._v("启动")]):"Running"===s.state.status?a("a",{on:{click:function(a){return t.stopProcess(s.id)}}},[t._v("停止")]):a("a",[t._v("停止")]),a("a",{on:{click:function(a){return t.openEdit(s,"edit")}}},["Running"===s.state.status?a("span",[t._v("查看")]):a("span",[t._v("修改")])]),"Exited"===s.state.status||"Stopped"===s.state.status?a("a-popconfirm",{attrs:{title:"确定要删除吗？"},on:{confirm:function(a){return t.deleteProcess(s.id)}}},[a("a-icon",{staticStyle:{color:"red"},attrs:{slot:"icon",type:"question-circle-o"},slot:"icon"}),a("a",{attrs:{href:"#"}},[t._v(" 删除")])],1):t._e(),a("a-dropdown",[a("a",{attrs:{href:"javascript:;"}},[a("a-icon",{attrs:{type:"ellipsis"}})],1),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",[a("a",{on:{click:function(a){return t.openEdit(s,"copy")}}},[t._v("拷贝")])])],1)],1)],1)],2)]:[a("a-button",{staticClass:"new-btn",attrs:{type:"dashed"},on:{click:function(a){return t.openEdit(s,"create")}}},[a("a-icon",{attrs:{type:"plus"}}),t._v(" 新增程序 ")],1)]],2)}}])})],2)},r=[],o=a("5530"),n=(a("ac1f"),a("1276"),a("644f")),i=a("c1df"),c=a.n(i),p={name:"ProcessList",data:function(){return{path:"",treeData:[],status:{alert:0,unknown:0,starting:0,running:0,exited:0,stopping:0,stopped:0,length:0,process:[]},ticker:null}},mounted:function(){var t=this;this.$route.params.path&&(this.path=this.$route.params.path),this.loadTreeData(),this.getProcess(),this.ticker=setInterval((function(){t.getProcess()}),2e3)},filters:{showAge:function(t){return c.a.unix(t).fromNow(!0)}},destroyed:function(){clearInterval(this.ticker)},methods:{loadTreeData:function(t){var s=this;Object(n["a"])().then((function(t){for(var a in s.treeData=[],t){var e=a.split("/"),r=s.treeData;for(var o in e){var n=e[o],i=!1;for(var c in r)if(r[c].id===n){i=!0,r=r[c].children;break}if(!i){for(var p=e[0],l=1;l<=o;l++)p+="/"+e[l];var u={id:n,title:p,key:p,value:p,children:[]};r.push(u),r=u.children}}}}))},onChange:function(t){this.path=t,this.getProcess()},getProcess:function(){var t=this,s={group:this.path};Object(n["e"])(s).then((function(s){for(var a in t.status={alert:0,unknown:0,starting:0,running:0,exited:0,stopped:0,stopping:0,length:0,process:[]},t.status.process.push({}),s){var e=s[a];t.status.length+=1,t.status.process.push(e),"Unknown"===e.state.status?t.status.unknown+=1:"Running"===e.state.status?t.status.running+=1:"Starting"===e.state.status?t.status.starting+=1:"Stopping"===e.state.status?t.status.stopping+=1:"Stopped"===e.state.status?t.status.stopped+=1:t.status.exited+=1}})).catch((function(t){}))},startProcess:function(t){var s=this;Object(n["f"])({id:t}).then((function(t){s.getProcess()}))},stopProcess:function(t){var s=this;Object(n["g"])({id:t}).then((function(t){s.getProcess()}))},deleteProcess:function(t){var s=this;Object(n["d"])({id:t}).then((function(t){s.getProcess()}))},openEdit:function(t,s){this.$router.push({name:"pedit",params:{option:s,path:this.path,treeData:this.treeData,item:Object(o["a"])({},t)}})},startAllProcess:function(){for(var t in this.status.process){var s=this.status.process[t];void 0===s.id||"Stopped"!==s.state.status&&"Exited"!==s.state.status||this.startProcess(s.id)}},stopAllProcess:function(){for(var t in this.status.process){var s=this.status.process[t];void 0!==s.id&&"Running"===s.state.status&&this.stopProcess(s.id)}},deleteGroup:function(){var t=this;""!==this.path&&Object(n["b"])({group:this.path}).then((function(s){t.path="",t.loadTreeData()}))},progressColor:function(t){return t>=80?"red":t>=50?"#EAC100":void 0},processBell:function(){this.$message.info("暂未实现该功能")}}},l=p,u=(a("c5bd"),a("2877")),d=Object(u["a"])(l,e,r,!1,null,"bc24ced8",null);s["default"]=d.exports},"644f":function(t,s,a){"use strict";a.d(s,"a",(function(){return o})),a.d(s,"b",(function(){return n})),a.d(s,"e",(function(){return i})),a.d(s,"c",(function(){return c})),a.d(s,"h",(function(){return p})),a.d(s,"d",(function(){return l})),a.d(s,"f",(function(){return u})),a.d(s,"g",(function(){return d}));var e=a("b775"),r={processList:"process/list",processCreate:"process/create",processUpdate:"process/update",processDelete:"process/delete",processStart:"process/start",processStop:"process/stop",groupList:"process/glist",groupAdd:"process/gadd",groupRemove:"process/gremove"};function o(t){return Object(e["b"])({url:r.groupList,method:"post",data:t})}function n(t){return Object(e["b"])({url:r.groupRemove,method:"post",data:t})}function i(t){return Object(e["b"])({url:r.processList,method:"post",data:t})}function c(t){return Object(e["b"])({url:r.processCreate,method:"post",data:t})}function p(t){return Object(e["b"])({url:r.processUpdate,method:"post",data:t})}function l(t){return Object(e["b"])({url:r.processDelete,method:"post",data:t})}function u(t){return Object(e["b"])({url:r.processStart,method:"post",data:t})}function d(t){return Object(e["b"])({url:r.processStop,method:"post",data:t})}},"6ae3":function(t,s,a){},c5bd:function(t,s,a){"use strict";a("6ae3")}}]);