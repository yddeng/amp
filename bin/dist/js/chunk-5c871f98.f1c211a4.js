(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c871f98"],{"0f66":function(t,e,o){"use strict";o.d(e,"a",(function(){return n})),o.d(e,"b",(function(){return s}));var r=o("b775"),a={nodeList:"node/list",nodeRemove:"node/remove"};function n(t){return Object(r["b"])({url:a.nodeList,method:"post",data:t})}function s(t){return Object(r["b"])({url:a.nodeRemove,method:"post",data:t})}},"328a":function(t,e,o){"use strict";var r=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("a-modal",{attrs:{title:"执行日志",width:1e3,centered:"",footer:"",maskClosable:!0,visible:t.visible},on:{cancel:t.cancel}},[o("a-card",{attrs:{bordered:!1,size:"small"}},[o("a-descriptions",{attrs:{title:"执行信息"}},[o("a-descriptions-item",{attrs:{label:"命令名称"}},[t._v(t._s(t.cmdName))]),o("a-descriptions-item",{attrs:{label:"执行ID"}},[t._v(t._s(t.record.id))]),o("a-descriptions-item",{attrs:{label:"执行用户"}},[t._v(t._s(t.record.user))])],1),o("a-descriptions",[o("a-descriptions-item",{attrs:{label:"状态"}},[t.record.result_at>0?o("span",{staticStyle:{color:"#3CB371"}},[t._v("已完成")]):o("span",{staticStyle:{color:"#48D1CC"}},[t._v("执行中")])]),o("a-descriptions-item",{attrs:{label:"创建时间"}},[t._v(t._s(t._f("formatDate")(t.record.create_at)))]),t.record.result_at>0?o("a-descriptions-item",{attrs:{label:"执行时长"}},[t._v(t._s(t.record.result_at-t.record.create_at)+" 秒")]):t._e()],1),o("a-descriptions",[o("a-descriptions-item",{attrs:{label:"执行节点"}},[t._v(t._s(t.record.node))]),o("a-descriptions-item",{attrs:{label:"执行目录"}},[t._v('"'+t._s(t.record.dir)+'"')])],1),o("a-divider",{staticStyle:{"margin-bottom":"12px"}}),o("a-descriptions",{attrs:{title:"脚本内容"}},[o("div",[o("a-textarea",{staticStyle:{background:"#0e0e0e",color:"white"},attrs:{value:t.record.context,"auto-size":{minRows:4,maxRows:10}}})],1)]),o("a-divider",{staticStyle:{"margin-bottom":"12px"}}),o("a-descriptions",{attrs:{title:"执行结果"}},[o("div",[o("a-textarea",{staticStyle:{background:"#0e0e0e",color:"white"},attrs:{value:t.record.result,"auto-size":{minRows:4,maxRows:10}}})],1)])],1)],1)},a=[],n=o("c1df"),s=o.n(n),i={name:"LogInfo",components:{moment:s.a},props:{visible:{type:Boolean,required:!0},cmdName:{type:String,default:"null"},record:{type:Object,default:null}},data:function(){return{}},filters:{formatDate:function(t){return s.a.unix(t).format("YYYY-MM-DD HH:mm:ss")}},mounted:function(){console.log(this.cmdName,this.record)},methods:{cancel:function(){this.$emit("cancel")}}},c=i,l=o("2877"),d=Object(l["a"])(c,r,a,!1,null,null,null);e["a"]=d.exports},6382:function(t,e,o){"use strict";o.r(e);var r=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("page-header-wrapper",{attrs:{breadcrumb:{},title:"执行命令",content:"( "+t.form.name+" )"},on:{back:function(){return t.$router.go(-1)}}},[o("a-card",{attrs:{bordered:!1}},[o("a-spin",{attrs:{spinning:t.spinning}},[o("a-form-model",{ref:"cmdExecForm",attrs:{model:t.form,rules:t.formRule,"label-col":{span:2},"wrapper-col":{span:20}}},[o("a-form-model-item",{attrs:{label:"命令类型"}},[o("span",[t._v("SHELL")])]),o("a-form-model-item",{attrs:{label:"命令内容"}},[o("a-textarea",{staticStyle:{background:"#0e0e0e",color:"white"},attrs:{"auto-size":{minRows:4,maxRows:10},readOnly:t.ctx_readonly},model:{value:t.form.context,callback:function(e){t.$set(t.form,"context",e)},expression:"form.context"}})],1),o("a-form-model-item",{attrs:{label:"执行目录","wrapper-col":{span:6}}},[o("a-input",{attrs:{placeholder:"非必填，默认为节点启动目录"},model:{value:t.form.dir,callback:function(e){t.$set(t.form,"dir",e)},expression:"form.dir"}})],1),o("a-form-model-item",{attrs:{"wrapper-col":{span:4},prop:"timeout"}},[o("span",{attrs:{slot:"label"},slot:"label"},[t._v(" 超时时间  "),o("a-tooltip",{attrs:{title:"可设置范围10～86400秒，默认60秒。超时后，会强制终止进程"}},[o("a-icon",{attrs:{type:"question-circle-o"}})],1)],1),o("a-input",{model:{value:t.form.timeout,callback:function(e){t.$set(t.form,"timeout",e)},expression:"form.timeout"}},[o("span",{attrs:{slot:"addonAfter"},slot:"addonAfter"},[t._v("秒")])])],1),o("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:t.hasArgs,expression:"hasArgs"}],attrs:{label:"命令参数"}},[o("a-row",{staticStyle:{background:"#F0F0F0"}},[o("a-col",{attrs:{span:4}},[t._v("  参数名")]),o("a-col",{attrs:{span:12}},[t._v("参数值")])],1),t._l(t.form.args,(function(e,r){return[o("a-row",{key:r},[o("a-col",{attrs:{span:4}},[o("span",[t._v("  "+t._s(r))])]),o("a-col",{attrs:{span:12}},[o("a-input",{model:{value:t.form.args[r],callback:function(e){t.$set(t.form.args,r,e)},expression:"form.args[kk]"}})],1)],1)]}))],2),o("a-form-model-item",{attrs:{label:"选择执行节点",prop:"node","wrapper-col":{span:4}}},[o("a-select",{attrs:{placeholder:"选择一个可执行的节点"},model:{value:t.form.node,callback:function(e){t.$set(t.form,"node",e)},expression:"form.node"}},[t._l(t.nodes,(function(e,r){return[o("a-select-option",{key:r,attrs:{value:e.name}},[t._v(" "+t._s(e.name)+" ")])]}))],2)],1),o("a-form-model-item",{attrs:{"wrapper-col":{span:12,offset:2}}},[o("a-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(" 执行命令 ")])],1)],1)],1)],1),o("a-log-info",{attrs:{visible:t.logInfoVisible,cmdName:t.logInfoCmd,record:t.logInfoRecord},on:{cancel:t.logInfoCancel}})],1)},a=[],n=o("5530"),s=(o("b64b"),o("d3b7"),o("d9e2"),o("0f66")),i=o("bb62"),c=o("328a"),l={name:"CmdExec",components:{"a-log-info":c["a"]},data:function(){return{formRule:{timeout:[{validator:this.checkTimout,message:"请设置一个合适的时间",trigger:"change"}],node:[{required:!0,message:"选择一个节点",trigger:"blur"}]},ctx_readonly:!0,hasArgs:!1,nodes:[],form:{id:0,name:"",context:"",dir:"",args:{},node:"",timeout:60},spinning:!1,logInfoVisible:!1,logInfoCmd:"",logInfoRecord:{}}},mounted:function(){this.$route.params.record?(this.form=Object(n["a"])(Object(n["a"])({},this.$route.params.record),{},{timeout:60}),this.hasArgs=Object.keys(this.form.args).length>0):this.$router.back(),this.getNodeList()},methods:{getNodeList:function(){var t=this,e={pageNo:1,pageSize:1e3};Object(s["a"])(e).then((function(e){for(var o in e.nodeList){var r=e.nodeList[o];r.online&&t.nodes.push(r)}}))},onSubmit:function(){var t=this;this.$refs.cmdExecForm.validate((function(e){if(!e)return console.log("error submit!!"),!1;var o={id:t.form.id,dir:t.form.dir,args:t.form.args,node:t.form.node,timeout:parseInt(t.form.timeout)},r=1e3*(t.form.timeout+6);console.log(r,t.form,o),t.spinning=!0,Object(i["c"])(r,o).then((function(e){console.log(e),t.spinning=!1,t.showLogInfo(e)})).catch((function(t){})).finally((function(e){t.spinning=!1}))}))},checkTimout:function(t,e,o){e<10||e>86400?o(new Error("请输入一个合适的超时时长")):o()},showLogInfo:function(t){this.logInfoVisible=!0,this.logInfoCmd=this.cmdName,this.logInfoRecord=t},logInfoCancel:function(){this.logInfoVisible=!1}}},d=l,m=o("2877"),u=Object(m["a"])(d,r,a,!1,null,"1f5daa03",null);e["default"]=u.exports},bb62:function(t,e,o){"use strict";o.d(e,"d",(function(){return n})),o.d(e,"a",(function(){return s})),o.d(e,"b",(function(){return i})),o.d(e,"f",(function(){return c})),o.d(e,"c",(function(){return l})),o.d(e,"e",(function(){return d}));var r=o("b775"),a={cmdList:"cmd/list",cmdCreate:"cmd/create",cmdDelete:"cmd/delete",cmdUpdate:"cmd/update",cmdExec:"cmd/exec",cmdLog:"cmd/log"};function n(t){return Object(r["b"])({url:a.cmdList,method:"post",data:t})}function s(t){return Object(r["b"])({url:a.cmdCreate,method:"post",data:t})}function i(t){return Object(r["b"])({url:a.cmdDelete,method:"post",data:t})}function c(t){return Object(r["b"])({url:a.cmdUpdate,method:"post",data:t})}function l(t,e){return Object(r["b"])({url:a.cmdExec,method:"post",timeout:t,data:e})}function d(t){return Object(r["b"])({url:a.cmdLog,method:"post",data:t})}}}]);
//# sourceMappingURL=chunk-5c871f98.f1c211a4.js.map